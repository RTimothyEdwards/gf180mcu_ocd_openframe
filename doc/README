Caravel Openframe for GF180MCU
--------------------------------------------------------------

These instructions are currently very incomplete.

The top level layout is "caravel_openframe.mag"

To create a new openframe chip with a custom user project:

(1) Clone or fork this repository
(2) Add verilog for the user project in ../verilog/rtl/
(3) The user project verilog top level should be named
    "openframe_user_project" in file "openframe_user_project.v",
    replacing the template file.
(4) If there are multiple verilog files in the user project,
    either include them from the top level verilog or add them
    to "netlists.v"
(5) Set the user ID for the project with ../scripts/set_user_id.sh.
(6) Do a top-level extraction for LVS with ../scripts/run_extract.sh
(7) Run LVS with run_lvs.sh in the ../validate/ directory.
(8) Generate pre-fill GDS using the script ../scripts/run_top_gds.sh
(9) Generate filled GDS using the script ../scripts/run_fill_gds.sh
(10) Copy the hash sums produced by the above script to "hashes.txt"
     for reference when submitting the project for manufacture.
(11) Works best to run local precheck before committing.  Precheck
     commands needs to be run in a nix-shell in the precheck
     repository and is:

	python3 precheck.py --input \
	/home/tim/gits/gf180mcu_ocd_openframe/gds/caravel_openframe_filled.gds.gz \
	--top caravel_openframe_top --slot 1x1

(12) Commit/push the final repository update, and submit.

For the initial test tapeout a number of modifications have
been made by hand and need to be integrated directly into the
flow.

The existing power connections are not being made by Librelane
and have been made by adding manual power routes after the
fact.  This includes the main power connections to the wrapper
as well as power connections to the macros internal to the
wrapper.  The latter can be fixed with appropriate changes to
the LibreLane config file.  The former can be automated but
needs to declare blockages in LibreLane where the connections
are placed, or else the connection layouts need to be done
manually each time to ensure no conflicting routes exist
between the power pins and the digital core power ring.

Minor corrections were made to the wrapper GDS and gate-level
verilog after the fact.  A few routes close to the edge
conflicted with circuitry underneath, which needs to be
declaring obstructions in the wrapper DEF file.  This is
mainly a failure to add the loopback routing cells to the
layout with a "flatten true" property to make them show up
in the DEF file.

The wrapper .mag file was compressed and can be read into
magic this way (after resolving some issues in the magic
code);  however, when compressed, the cell in magic
becomes read-only, so if there is any need to edit the
cell it needs to be uncompressed first.

At the moment, LVS fails on the I/O corner cell by merging
VSS and DVSS;  this error propagates up to the top.  This
has been mitigated in LVS by preventing all cells from the
I/O corner cell up to the top from being flattened.  The
top level cell should be an LVS match, with the corner
cell showing as a match failure.

Also at the moment, LVS fails on the ROM program cells
because netgen does not correctly read the "generate"
block assignments in the verilog file.  Rather than work
around the error, I am letting the error stand until I
code in handling of the assignments into verilog, because
otherwise this requires tedious manual correction.

Other errata:  Currently most macros (namely SRAM and
standard cells, but not I/O) are being ignored by LVS.


To do:  Collect all the scripts into a Makefile.
